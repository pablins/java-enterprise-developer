<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui">

	<ui:composition template="/WEB-INF/templates/master.xhtml">
			<ui:define name="content">
				<h1>Personas</h1>
				<!-- importante establecer el enctype cuando se desee enviar archivos en un formulario, sino se recibirá null -->
				<h:form enctype="multipart/form-data">
					<!-- En el evento onclick llamamos la función de primefaces con el id del componente para hacer la función javascript de mostrar el dialogo -->
					<p:commandButton value="Nuevo" onclick="PF('dlg').show()"/>
					
					<!-- modal=true -> Es para que se vea como un modal colocando traslucido la parte de atras -->
					<!-- widgetVar -> corresponde al id en javascript que le asigna primefaces -->
					<!-- colseOnEscape=true -> para que se cierre con tecla ESC -->
					<!-- resizable -> para permitir modificar el tamaño del dialog -->
					<!-- draggable -> para permitir arrastrar el dialog -->
					<p:dialog header="Nueva Persona" modal="true" widgetVar="dlg" closeOnEscape="true" resizable="false" draggable="true">
						<h:panelGrid id="pg" columns="3">
							<!-- nombres -->
							<p:outputLabel for="txtNombres" value="Nombres"/>
							<p:inputText id="txtNombres" value="#{personaBean.persona.nombres}" required="true"/>
							<p:message for="txtNombres" display="icon"/>

							<!-- apellidos -->
							<p:outputLabel for="txtApellidos" value="Apellidos"/>
							<p:inputText id="txtApellidos" value="#{personaBean.persona.apellidos}" required="true"/>
							<p:message for="txtApellidos" display="icon"/>

							<!-- sexo -->
							<p:outputLabel for="txtSexo" value="Sexo"/>
							<p:inputText id="txtSexo" value="#{personaBean.persona.sexo}" required="true"/>
							<p:message for="txtSexo" display="icon"/>

							<!-- dirección -->
							<p:outputLabel for="txtDireccion" value="Dirección"/>
							<p:inputText id="txtDireccion" value="#{personaBean.persona.direccion}"/>
							<p:message for="txtDireccion" display="icon"/>

							<!-- pais -->
							<p:outputLabel for="txtPais" value="País"/>
							<p:inputText id="txtPais" value="#{personaBean.persona.pais}" required="true"/>
							<p:message for="txtPais" display="icon"/>
							
							<!-- foto -->
							<p:outputLabel for="fuFoto" value="Foto"/>
							<!-- Forma de subir foto con mode=simple, es necesario colocar el botón con ajax=false -->
							<!-- p:fileUpload value="#{personaBean.uploadedFileFoto}" mode="simple" skinSimple="true" label="Examinar..."/-->
							<!-- Al colocar un for en el outputLabel, el nombre del label del componente fileUpload queda con el nombre del outputLabel y no se le hace caso al label de fileUpload -->
							<p:fileUpload id="fuFoto" fileUploadListener="#{personaBean.handleFileUpload}" mode="advanced" multiple="false" cancelLabel="Cancelar" uploadLabel="Subir" label="Examinar..."/>
							<p:message for="fuFoto" display="icon"/>
						</h:panelGrid>
						
						<!-- El método Operar lo usaremos para Registrar (R) o Modificar (M) el registro de acuerdo al parametro que reciba -->
						<!-- importante establecer ajax=false para poder subir el archivo cuando se usa mode=simple, sino llegará null. Dado que por default primefaces trabaja las peticiones como ajax. O se podria manejar un componente más avanzado de primefaces(un mode diferente al simple) de subida de archivo donde ya no obliga a que el ajax sea false -->
						<!-- Debido a que ajax=false, se agrega en el oncomplete que no se cierre el dialogo cuando existen validaciones que no se han cumplido -->
						<!-- El caracter de ampersand no es permitido por tanto se utiliza su opción de escape. Dado que en XML no se puede colocar el ampersand y xhtml es una variante de XML -->
						<!-- Al utilizar ajax es importante establecer el valor del atributo update para que primefaces sepa que componente debe refrescar  -->
						<p:commandButton value="Registrar" actionListener="#{personaBean.operar('R')}" ajax="true" oncomplete="if (args &amp;&amp; !args.validationFailed) PF('dlg').hide()" update="pg"/>
						
					</p:dialog>
				
				</h:form>
			</ui:define>
	</ui:composition>

</html>